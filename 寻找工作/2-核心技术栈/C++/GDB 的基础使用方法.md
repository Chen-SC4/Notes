# GDB 的基础使用方法

## 1. Hello World

下面是一个简单的示例程序 `main`：

```cpp
#include <iostream>

int main() {
    int j = 3;
    int k = 7;

    j += k;
    k = j * 2;
    std::cout << "Hello, World!" << std::endl;
    std::cout << "j: " << j << ", k: " << k << std::endl;
    return 0;
}
```

首先要使用 `gdb` 我们需要在编译时添加一些编译选项：

```bash
> g++ -g -std=c++14 ./main.cpp -o main
```

其中 `-g` 指令表示生成==调试符号==，它用于将机器码与原始的代码关联起来。如果没有调试符号，我们只能对着内存地址和机器指令来调试了。

`-std` 指定了我们使用的 `C++` 版本是 `C++14`。

`-o` 指定生成的可执行文件的名称，如果不指定，则默认生成 `a.out`。

接下来使用 `gdb` 来运行程序：

```bash
> gdb ./main
```

然后会看到我们进入了 `gdb` 程序的运行环境：

```bash
(gdb)
```

下面介绍 `gdb` 中的第一个指令：`run`，它用于运行程序。

## 2. 基础指令

### 2.1 运行

运行指令在之前已经介绍过了，就是 `run` 指令，如果我们想要传递一些命令行参数给程序，也只需要在 `run` 后面加上即可。

```bash
(gdb) run arg1  arg2
```

### 2.2 断点

在程序运行的过程中，我们可能需要在某个地方暂停程序，这时候就需要使用断点。在 `gdb` 中，通过 `break` 指令给程序打上断点，可以在某一行打上断点，也可以在某个函数打上断点。

```bash
(gdb) break main
```

这样就在 `main` 函数的第一行打上了断点，然后使用 `run` 指令运行程序，程序会在 `main` 函数的第一行停下来。

此时如果我们想要程序往下执行，可以使用 `continue` 指令，如果我们只想执行一行代码，可以使用 `next` 指令。

我们还可以使用 `list` 指令，来查看当前运行到哪里了，以及它周围的代码。

### 2.3 查看变量

在 `gdb` 中，我们可以使用 `print` 指令来查看变量的值。

```bash
(gdb) print j
```

`print` 指令不仅可以查看变量的值，还可以查看表达式的值。

```bash
(gdb) print j + k
```

不过 `print` 指令只能临时查看变量的值，如果我们想要持续查看变量的值，可以使用 `display` 指令。

如果不想持续查看，可以使用 `undisplay` 指令来取消持续查看。

### 2.4 查看调用堆栈

在程序运行的过程中，我们可能需要查看调用堆栈，这时候可以使用 `backtrace` 指令。它可以打印出整个调用堆栈。

如果想要临时查看当前位置上、下的调用堆栈，可以使用 `up` 和 `down` 指令。

### 2.5 步入函数和步出函数

在程序运行的过程中，我们可能需要进入某个函数中查看函数内部的执行情况，这时候可以使用 `step` 指令。

```bash
(gdb) step
```

如果我们想要直接执行完当前函数，可以使用 `finish` 指令。

### 2.6 监视变量

在程序运行的过程中，我们可能需要监视某个变量的值，当它的值发生变化时，我们希望程序停下来。这时候可以使用 `watch` 指令。

`watch` 创造的也是一种断点，只不过它是在某个变量的值发生变化时触发。

### 2.7 查看断点以及删除断点

有的时候，我们想要查看当前所有的断点，可以使用 `info breakpoints` 指令。

`info` 指令可以查看很多信息，比如查看当前的变量、查看当前的函数等。

至于删除断点，可以使用 `delete` 指令，后面可以加上断点的编号，也可以加上函数名。

## 3. 高级指令

### 3.1 反向调试

在调试时，有的时候会出现这样的情况：我们不停地往下执行，然后突然执行过头了，我们想要回到之前的某个位置，这时候可以使用 `reverse-step` 和 `reverse-continue` 指令，不过想要进行反向调试，需要先告诉 `gdb` 保存程序的执行历史，通过执行 `target record-full` 指令。

### 3.2 热更新

在调试时，有的时候我们想要修改程序的某个变量的值，这时候可以使用 `set` 指令。

```
(gdb) set var j = 10
```
